{% extends 'Agent/layout/header.html' %}

{% block content %}

{% load static %}

{% if user %}
<!-- start page content -->
{% include 'cotrav_alert_message.html' %}
 <div class="page-content-wrapper">
                <div class="page-content">

                    {% for visa in bookings %}

    <form method="post" action="/agents/assign-visa-request/{{visa.id}}" enctype="multipart/form-data">
    <input type="hidden" name="booking_id" value="{{visa.id}}">
    <input type="hidden" id="corporate_id" value="{{visa.corporate_id}}">
    <input type="hidden" name="user_id" value="{{user.id}}">
    <input type="hidden" name="current_url" value="{{ request.get_full_path }}">
    <input type="hidden" name="checkin" id="checkin" value="{{ visa.checkin_datetime }}">
    <input type="hidden" name="checkout" id="checkout" value="{{ visa.checkout_datetime }}">
    <input type="hidden" name="tax_on_management_fee" id="tax_on_management_fee" value="0">
    <input type="hidden" name="tax_on_management_fee_percentage" id="tax_on_management_fee_percentage" value="0">

    <input type="hidden" name="management_fee_igst" id="management_fee_igst" value="0">
    <input type="hidden" name="management_fee_cgst" id="management_fee_cgst" value="0">
    <input type="hidden" name="management_fee_sgst" id="management_fee_sgst" value="0">
    <input type="hidden" name="management_fee_igst_rate" id="management_fee_igst_rate" value="0">
    <input type="hidden" name="management_fee_cgst_rate" id="management_fee_cgst_rate" value="0">
    <input type="hidden" name="management_fee_sgst_rate" id="management_fee_sgst_rate" value="0">

    <input type="hidden" name="igst_amount" id="igst_amount" value="0">
    <input type="hidden" name="cgst_amount" id="cgst_amount" value="0">
    <input type="hidden" name="sgst_amount" id="sgst_amount" value="0">

	<input class="form-control" type = "hidden" name="management_fee" id="mng_fee" >
	<input class="form-control" type = "hidden" name="tax_mng_amt" id="tax_mng_amt" >
	<input class="form-control" type = "hidden" name="sub_total" id="total_billing_amt" >
	<input class="form-control" type = "hidden" name="cgst" id="cgst" >
	<input class="form-control" type = "hidden" name="sgst" id="sgst" >
	<input class="form-control" type = "hidden" name="igst" id="igst" >
	<input class="form-control" type = "hidden" name="oper_cgst" id="oper_cgst" >
	<input class="form-control" type = "hidden" name="oper_sgst" id="oper_sgst" >
	<input class="form-control" type = "hidden" name="oper_igst" id="oper_igst" >
	<input type="hidden" id="old_ticket_price" value="{{visa.ticket_price|default:'0'}}">
	<input type="hidden" id="old_vi_ticket_price" value="{{visa.vi_ticket_price|default:'0'}}">
	<input type="hidden" id="old_vender_commission" value="{{visa.vender_commission|default:'0'}}">

<div class="text-center">
            <input type="submit" class="btn btn-info" value="assign Visa Request Details">
                 </div>

        <br>
                     <div class="row">

						<div class="col-md-3">

						<div class="row">

							<div class="col-md-12">


							<div class="card" >
								<div class="card-head card-topline-aqua">
									<header>Basic Details: </header>
								</div>

								<div class="card-body no-padding height-9">

									<div class="form-group row">
							 			<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">
											<tr>
                                    <td>Request ID</td>
                                    <td>{{ visa.reference_no }}</td>
                                </tr>

                                 <tr>
                                    <td>Visa Country</td>
                                    <td>{{ visa.country_name }}</td>
                                </tr>
                                <tr>
                                    <td>Visa Type</td>
                                    <td>{{ visa.visa_type_name|default:'' }}</td>
                                </tr>

                                <tr>
                                    <td>Visa Request Type</td>
                                    <td>{{ visa.request_type }}</td>
                                </tr>


                                <tr>
                                    <td>Visa Duration</td>
                                    <td>{{ visa.visa_duration }} Month</td>
                                </tr>


                                <tr>
                                    <td>Consulate Office</td>
                                    <td>{{ visa.address_line_1|default:'' }}{{ visa.address_line_2|default:'' }}{{ visa.address_line_3|default:'' }}</td>
                                </tr>
                                <tr>
                                    <td>No Of Employees</td>
                                    <td>{{ visa.no_of_employees }}</td>
                                </tr>
                                <tr>
                                    <td>Application Status</td>
                                    <td> Document Verified</td>
                                </tr>

                                <tr>
                                    <td>Visa Status</td>
                                    <td>{{visa.client_status|default:''}}</td>
                                </tr>

                                <tr>
                                    <td>Cotrav Status</td>
                                    <td>{{visa.cotrav_status|default:''}}</td>
                                </tr>


										</table>
									</div>





								</div>
							</div>

						</div>


						</div>

								<div class="row">

							<div class="col-md-12">

								<div class="card" >
								<div class="card-head card-topline-aqua">
									<header>SPOC Details: </header>

								</div>

								<div class="card-body no-padding height-9">

									<div class="form-group row">
							 			<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">

											<tr>
												<td><label class="control-label" >SPOC Name</label></td>
												<td><input class="form-control" type = "text" name="user_name"  id = "user_name" value="{{ visa.user_name|default:'' }}" readonly></td>
											</tr>

											<tr>
												<td><label class="control-label" >Contact Number</label></td>
												<td><input class="form-control" type = "text" id = "user_contact" name="user_contact" value="{{ visa.user_contact|default:'' }}" readonly></td>
											</tr>

											<tr>
												<td><label class="control-label" >Email ID</label></td>
												<td><input class="form-control" type = "text" id = "email" name="email"  value="{{ visa.user_email|default:'' }}" readonly></td>
											</tr>


										</table>

									</div>

								</div>
							</div>


							</div>





						</div>




						</div>


						<div class="col-md-3">

							<div class="row">

								<div class="col-md-12">

									<div class="card" >
								<div class="card-head card-topline-aqua">
									<header>Assigned Visa Details: </header>

								</div>
								<div class="card-body no-padding height-9">

									<div class="form-group row">
							 			<table class="table table-striped ">

											<tr>
												<td><label class="control-label" >Select Operator</label></td>
												<td><select name="operator_id" class="col-sm-8 form-control myselect" style="width:100%;" required>
												<option value="">Select Operator</option>
													{% for bus_port in bus_operators %}
														<option value="{{bus_port.id}}"> {{bus_port.operator_name}}</option>
													{% endfor %}
											</select></td>
											</tr>

											<tr>
												<td><label class="control-label">Visa Booking ID</label></td>
												<td><input class="form-control" type = "text" name="assign_visa_bid" placeholder="Visa Booking ID" value="{{visa.assign_visa_bid|default:''}}" required></td>
											</tr>
											<tr>
												<td><label class="control-label">Issuing Post Name</label></td>
												<td><input class="form-control" type = "text" name="assign_post_name" placeholder="Issuing Post Name" value="{{visa.assign_post_name|default:''}}" required></td>
											</tr>

											<tr>
												<td><label class="control-label">Issuing Post Number</label></td>
												<td><input class="form-control"  type = "text" name="assign_post_number" value="{{ visa.assign_post_number|default:'' }}" placeholder="Issuing Post Number" required></td>
											</tr>

											<tr>
												<td><label class="control-label" >Visa Type*</label></td>
												<td><input class="form-control" type="text" name="assign_visa_type" placeholder="Visa Type" value="{{visa.assign_visa_type|default:''}}" required></td>
											</tr>

											<tr>
												<td><label class="control-label" >Issue Date*</label></td>
												<td><input class="form-control datepicker1" type="text" name="assign_visa_date" autocomplete="off" placeholder="Issue Date" value="{{visa.assign_visa_date|default:''}}" required></td>
											</tr>

											<tr>
												<td><label class="control-label" >Expiry Date</label></td>
												<td><input class="form-control datepicker1" type = "text" name="assign_visa_expiry" autocomplete="off" value="{{ visa.assign_visa_expiry|default:'' }}" placeholder="Expiry Date"></td>
											</tr>

											<tr>
												<td><label class="control-label" >Send SMS</label></td>
												<td><select name="is_client_sms" class="col-sm-8 form-control myselect" style="width:100%;">
												<option value="1">Yes</option>
                                    			<option value="0">No</option>
											</select></td>
											</tr>
											<tr>
												<td><label class="control-label" >Send Email</label></td>
												<td><select name="is_client_email" class="col-sm-8 form-control myselect" style="width:100%;">
												<option value="1">Yes</option>
                                    			<option value="0">No</option>
											</select></td>
											</tr>



										</table>

									</div>

								</div>
							</div>


								</div>


							</div>

							<div class="row">

							<div class="col-md-12">

							{% if visa.operator_name %}

								<div class="card" >
								<div class="card-head card-topline-aqua">
									<header>Operator Details: </header>

								</div>

								<div class="card-body no-padding height-9">

									<div class="form-group row">
							 			<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">

											<tr>
												<td><label class = "control-label">Operator Name</label></td>
												<td><input class = "form-control" type = "text" name="operator_name"  id = "operator_name" value="{{ visa.operator_name|default:'' }}" readonly></td>
											</tr>

											<tr>
												<td><label class = "control-label">Contact Number</label></td>
												<td><input class = "form-control" type = "text" id = "operator_contact" name="operator_contact" value="{{ visa.operator_contact|default:'' }}" readonly></td>
											</tr>


										</table>

									</div>

								</div>
							</div>


							{% endif %}



							</div>



						</div>







						</div>

						<div class="col-md-6">

							<div class="row">

							<div class="col-md-6">



								<div class="card" >
								<div class="card-head card-topline-aqua">
									<header>Client Billing Details </header>

								</div>

								<div class="card-body no-padding height-9">

									<div class="form-group row">
							 			<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">



											<tr>
												<td><label class="control-label">Ticket Price</label></td>

												<td><input class="form-control" type = "text" decimals="2" name="ticket_price" id="ticket_price"></td>
											</tr>

											<tr>
												<td><label class="control-label" >Select Cotrav Billing Entity</label></td>
												<td><select id="cotrav_billing_entity" name="cotrav_billing_entity" style="width:100%;" class="col-sm-8 form-control myselect" required>

													 {% for c_enttity in c_entitys %}
														<option value="{{c_enttity.id}}" gst="{{c_enttity.gst_id}}">{{c_enttity.entity_name}} </option>
													{% endfor %}
											</select></td>
											</tr>
											<tr>
												<td><label class="control-label" >Booking Billing Entity</label></td>
												<td><input type="text" class="form-control" name="bb_entity" gst="{{be_gst}}" id="booking_billing_entity" value="{{be_name}}"></td>
											</tr>


											<tr>
												<td><label class="control-label" >Browse Visa</label></td>
												<td><input type="file" class="form-control" name="busticketToUpload" id="bus-ticket"></td>
											</tr>


										</table>

									</div>

								</div>
							</div>





							</div>

								<div class="col-md-6">

								<div class="card">
								<div class="card-head card-topline-aqua">
									<header>Operator Billing Details </header>

								</div>

								<div class="card-body no-padding height-9">

									<div class="form-group row">
							 			<table class="table table-striped table-bordered bootstrap-datatable datatable responsive" >

											<tr>
												<td><label class="control-label">Ticket Price</label></td>
												<td><input class="form-control" decimals="2" type="text" name="oper_ticket_price" id="oper_ticket_price" required placeholder="Operator Ticket Price" ></td>
											</tr>

											<tr>
												<td><label class="control-label">Commission</label></td>
												<td><input class="form-control" type="text" name="operator_commission" id="operator_commission" required placeholder="Operator Commission" value="{{visa.v_operator_commission|default:''}}"></td>
											</tr>

											<tr>
												<td><label class="control-label" >Commission Type</label></td>
												<td><select id="oper_commission_type" name="oper_commission_type" class="mdl-textfield__input myselect" style="width:100%;" required>
												<option value="1">Percent</option>
												<option value="2">Fixed</option>
											</select></td>
											</tr>

											<tr>
												<td><label class="control-label" >Select Cotrav Billing Entity</label></td>
												<td><select id="cotrav_billing_entity1" name="cotrav_billing_entity" class="col-sm-8 form-control myselect" style="width:100%;" required>

													 {% for c_enttity in c_entitys %}
														<option value="{{c_enttity.id}}" gst="{{c_enttity.gst_id}}">{{c_enttity.entity_name}} </option>
													{% endfor %}
											</select></td>
											</tr>


											<tr>
												<td><label class="control-label" >Browse Vendor Visa</label></td>
												<td><input type="file" class="form-control" name="vendorticketToUpload" id="vendor-bus-ticket"></td>
											</tr>


										</table>

									</div>

								</div>
							</div>

								</div>


							</div>





						</div>



					</div>

<!--- operator billing details ---->


</form>
                </div>


            </div>
				<div>

				</div>


{% endfor %}


{% else %}
<p>Welcome, new user. Please log in.<a href="/login">Login</a></p>
{% endif %}

<script type="text/javascript">

$('#taxi_details').change(function(){
     var taxi_detail = $('#taxi_details option:selected').data('details');
    temp = taxi_detail.split(',');

    if(temp[0] != '' ){
        $("#taxi_reg_no").val(temp[0]);
        $("#garage_location").val(temp[1]);
        $("#garage_distance").val(temp[2]);
     }
     else{
        $("#taxi_reg_no").val('');
        $("#garage_location").val('');
        $("#garage_distance").val('');
     }
});
 </script>

<script type="text/javascript">
$('#client_ticket').change(function(){
if($('#client_ticket').is(":checked"))
        $("#client-tkt").hide();
    else
        $("#client-tkt").show();
});

$(window).on("load", function () {
	old_ticket_price = $('#old_ticket_price').val();
	old_vi_ticket_price = $('#old_vi_ticket_price').val();
	old_vender_commission = $('#old_vender_commission').val();
	setTimeout(function() {
   $('#ticket_price').val(old_ticket_price);
   $('#oper_ticket_price').val(old_vi_ticket_price);
   $('#operator_commission').val(old_vender_commission);
  }, 3000);

});
</script>


<script>
	user_type = {{request.session.login_type}}

	auth_token = "Token {{request.session.agent_access_token}}";

	var url_tax = '{{ API_BASE_URL }}'+'get_corporate_management_tax' ;

	var serve_type = 11;

</script>

<script src="{% static 'assets/js/assign_tax.js' %}" ></script>




 {% endblock %}