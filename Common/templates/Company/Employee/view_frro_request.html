{% extends 'Company/Employee/layout/header.html' %}
{% load static %}
{% block content %}
{% load datetime_format %}
{% if user %}
<!-- start page content -->
{% for visa in visas %}
<div class="modal fade" role="dialog" id="modalAddHotelStatus_office">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title-status">Add FRRO Office Update</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <form action="/Corporate/Employee/change-frro-booking-office-status" method="post" enctype="multipart/form-data">

        <input type="hidden" name="current_url" value="{{ request.get_full_path }}">
        <input class="form-control" type="hidden" name="booking_id" id="office_booking_id">
        <input class="form-control" type="hidden" name="booking_id_main" value="{{visa.id}}">
        <!-- Modal body -->
        <div class="modal-body" style="font-size: 12px">
        <table class="table table-striped table-bordered">


        <tr>
            <th ><label>Select Status Type</label>  </th>
            <td>
                <select name="status_type" id="status_type" class="form-control">
                    <option value="Change Status">--Select Status Type--</option>
                    <option value="Payment Request">Payment Request</option>
                    <option value="Additional Document">Additional Document</option>
                    <option value="Password Reset">Password Reset</option>
                    <option value="Other">Other</option>
                </select>
            </td>
        </tr>
        <tr>
            <th > <label id="status_lbl">Document Type/Status</label> </th>
            <td>
                <input type="text" name="status" class="form-control">
            </td>
        </tr>
        <tr>
            <th > <label id="comment_lbl">Comment</label>  </th>
            <td>
                <input type="text" name="status_comment" class="form-control">
            </td>
        </tr>
        <tr>
            <th> Select Document(If Any) </th>
            <td>
                <input type="file" name="booking_email" class="form-control">
            </td>
        </tr>

        </table>


        </div>
         <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-success" >Update Status</button>
      </div>
    </form>


    </div>
  </div>
</div>


<div class="modal fade" role="dialog" id="modalAddHotelStatus_letter">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title-status">Upload Signed Document Form </h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <form id="payment_request_form" action="/Corporate/Employee/change-frro-booking-document-letter" method="post" enctype="multipart/form-data">

        <input type="hidden" name="current_url" value="{{ request.get_full_path }}">
        <input class="form-control" type="hidden" name="booking_id" id="letter_booking_id">
        <input class="form-control" type="hidden" name="booking_id_main" value="{{ visa.id }}">
        <!-- Modal body -->
        <div class="modal-body">
        <table class="table table-striped table-bordered">

        <tr>
            <th id="booking_reason_lbl"> Select Documnet </th>
            <td>
                <input type="file" name="booking_email" required>
            </td>
          </tr>

        </table>


        </div>
         <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" >Update Document</button>
      </div>
    </form>


    </div>
  </div>
</div>



<div class="modal fade model_custom_style" role="dialog" id="model_action_tracking">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title-status">Change FRRO Document</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
            <form action="/Corporate/Employee/frro-change-document" method="post" enctype="multipart/form-data">
                <input type="hidden" name="document_id" id="booking_id_tracking">

                <input type="hidden" name="current_url" value="{{ request.get_full_path }}">

                <div class="modal-body">
                <div class="row">
                    <label class="control-label col-sm-4">Select Documnet</label>
                    <input type="file" required name="documnet_file" class="form-control col-sm-8">
                </div>
                </div>


                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">No</button>
                    <button id="delete_btn1" type="submit" class="btn btn-primary">Update</button>
                </div>
            </form>
            </div>

        </div>
    </div>
</div>







<!--{{bookings}}-->
<div class="page-content-wrapper">
    <div class="page-content">

                 <div class="text-center">
                 <div style="font-size:14px; font-weight:bold;">
                     Frro Request Details
                     </div>
            </div>

         <input type="hidden" name="tab_status" id="tab_status" value="{{visa.tab_status}}">

        {% if visa.tab_status == 'cancelled'%}

            <div class="row">
                 <div class="col-md-2 col-md-offset-5 booking-detail-row" style="background-color: red; color: #ffffff; margin-top: 5px; margin-bottom: 5px; text-align: center;"><i class="fa fa-times" style="font-size: 16px; top: 4px; " aria-hidden="true"></i> <h4 style="border-bottom: none; color: #fff; font-size: 12px;">Cancelled Request</h4></div>
			</div>
          {% else %}
            <br/>
            <div style="top:4px;" class="progress-bar-wrapper"></div>
            <br/>
          {% endif %}








        <div class="row">

            <div class="col-md-3">

				 <div class="card">
                    <div class="card-head card-topline-aqua">
                        <header>Request Details</header>
                    </div>
                    <div class="card-body no-padding height-9">

                        <div class="form-group row">
							<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">

                                <tr>
							<th>Booking ID</th>
							<td>{{ visa.reference_no }}</td>
						</tr>
                                                <tr>
                        <th>FRO Application ID</th>
                        <td>{{ visa.frro_application_id|default:'NA' }}</td>
                    </tr>
						<tr>
	                        <th>Booking Date</th>
	                        <td>{{ visa.booking_datetime|datetime_format }}</td>
	                    </tr>
	                    <tr>
	                        <th>Resident City</th>
	                        <td>{{ visa.hotel_city_name }}</td>
	                    </tr>
                    	<tr>
	                        <th>Request Type</th>
	                        <td>{{ visa.frro_request_type_name }}</td>
	                    </tr>
	                    <tr>
	                        <th>Company Status</th>
	                        <td>{{ visa.client_status }}</td>
	                    </tr>

	                    <tr>
	                        <th>CoTrav Status</th>
	                        <td>{{ visa.cotrav_status }}</td>
	                    </tr>

	                    <tr>
	                        <th>FRRO Status</th>
	                        <td>{{ visa.request_status }}</td>
	                    </tr>

	                    <tr>
	                        <th>Accepted By</th>
	                        <td>{{ visa.last_action_by }}</td>
	                    </tr>



	                    <tr>
	                        <th>Assessment Code / Project Code</th>
	                        <td>{{ visa.assessment_code }}</td>
	                    </tr>
	                    <tr>
	                        <th>Reason for Booking</th>
	                        <td>{{ visa.reason_of_booking }}</td>
	                    </tr>
                            <tr>
	                        <th>Registered Email</th>
	                        <td>{{ visa.registered_email }}</td>
	                    </tr>
                            <tr>
	                        <th>Registered Username</th>
	                        <td>{{ visa.registered_username }}</td>
	                    </tr>
                            <tr>
	                        <th>Registered Password</th>
	                        <td>{{ visa.registered_password }}</td>
	                    </tr>

                            <tr>
                        <th>Certificate</th>
                        <td>{% if visa.frro_certificate %}<a href="{{visa.frro_certificate}}">Download</a>{% else %}<label style="color:red;">NA</label>{% endif %}</td>
                    </tr>



							 </table>
                    </div>
                </div>
            </div>


                  <div class="card">
                    <div class="card-head card-topline-aqua">
                        <header>Log History </header>
                    </div>
                    <div class="card-body no-padding height-9">

                        <div class="form-group row">
							<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">



	                            {% for log in visa.ActionLogs %}
                                <tr>
                                      <td>
	                                <b>{{log.employee_name}}</b>&nbsp;[{{log.action_date}}]
                                        &nbsp;{{log.action}}
                                        <br/>
                                          </td>
                                    </tr>
	                            {% endfor %}




							 </table>
                        </div>

                    </div>
                    </div>



			</div>

            <div class="col-md-3">
            <div class="card">
                    <div class="card-head card-topline-aqua">
                        <header>SPOC Details</header>
                    </div>
                    <div class="card-body no-padding height-9">

                        <div class="form-group row">
							<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">
								 <tr>
                                    <td>SPOC Name</td>
                                    <td>{{ visa.user_name }}</td>
                                </tr>

								 <tr>
                                    <td>Contact</td>
                                    <td>{{ visa.user_contact }}</td>
                                </tr>
								 <tr>
                                    <td>Email Id</td>
                                    <td>{{ visa.spoc_email }}</td>
                                </tr>

							 </table>
                        </div>

                    </div>
                    </div>


                  <div class="card">
                    <div class="card-head card-topline-aqua">
                        <header>Request Letter Details</header>
                    </div>
                    <div class="card-body no-padding height-9">

                        <div class="form-group row">
							<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">

                                <tr>
                                                <th style="width: 10%;">Sr. No.</th>
                                                <th style="width: 20%;">Letter Name</th>
                                                <th style="width: 20%;">Draft Letter</th>
                                                <th style="width: 40%;">Signed Letter</th>
                                                <th style="width: 10%;">Action</th>
                                            </tr>



	                            {% for log in visa.RequestLetters %}
                                 <tr>
                                    <td style="width: 10%;">{{ forloop.counter }}</td>
                                    <td style="width: 30%;">{% if log.document_name %}{{log.document_name}}{% else %}NA{% endif %}</td>
                                    <td style="width: 20%;">{% if log.document_path %}<a href="{{log.document_path}}">Download</a>{% else %}<label style="color:red;">Not Upload</label>{% endif %}</td>
                                    <td style="width: 20%;">{% if log.upload_document %}<a href="{{log.upload_document}}">Download</a>{% else %}<label style="color:red;">Not Upload</label>{% endif %}</td>
                                    <td style="width: 20%;"><a href="" data-toggle="modal" data-target="#modalAddHotelStatus_letter" data-status_booking_id="{{log.id}}">
                                        <button class="btn btn-primary btn-xs">Change</button> </a></td>
                                     </tr>
	                            {% endfor %}




							 </table>
                        </div>

                    </div>
                    </div>


                  <div class="card">
                    <div class="card-head card-topline-aqua">
                        <header>FRRO Office Updates

                        </header>
                        <a href="" data-toggle="modal" data-target="#modalAddHotelStatus_office" data-office_booking_id="{{visa.id}}">
                            <button class="btn btn-primary btn-xs">Add FRRO Office Update</button> </a> </div>
                    <div class="card-body no-padding height-9">

                        <div class="form-group row">
							<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">

                                <tr>
                                               <th style="width: 10%;">Sr. No.</th>
                                                <th style="width: 10%;">Type</th>
                                                <th style="width: 10%;">Status</th>
                                                <th style="width: 20%;">Employee Comment</th>
                                                <th style="width: 20%;">CoTrav Comment</th>
                                                <th style="width: 10%;">Client Doc</th>
                                                <th style="width: 10%;">CoTrav Doc</th>
                                </tr>



	                            {% for log in visa.OfficeStatus %}
                                <tr>
                                    <td style="width: 10%;">{{ forloop.counter }}</td>
                                    <td style="width: 10%;">{{log.office_status_type}}</td>
                                    <td style="width: 10%;">{{log.office_status}}</td>
                                    <td style="width: 20%;">{{log.spoc_comment}}</td>
                                    <td style="width: 20%;">{{log.taxivaxi_comment}}</td>
                                    <td style="width: 10%;">{% if log.spoc_doc %}<a href="{{log.spoc_doc}}">Download</a>{% else %}<label style="color:red;">Not Upload</label>{% endif %}</td>
                                    <td style="width: 10%;">{% if log.taxivaxi_doc %}<a href="{{log.taxivaxi_doc}}">Download</a>{% else %}<label style="color:red;">Not Upload</label>{% endif %}</td>
                                </tr>
	                            {% endfor %}




							 </table>
                        </div>

                    </div>
                    </div>



            </div>


            <div class="col-md-6">


                <div class="card">
                    <div class="card-head card-topline-aqua">
                        <header>Employee Details</header>
                    </div>
                    <div class="card-body no-padding height-9">

                        <div class="form-group row">
							<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">

                                <tr>
                                    <th>Employee ID</th>
									<th>  Name  </th>
									<th>  Email Id </th>
									<th>  Contact  </th>
									<th>  Age   </th>
									<th>  Gender </th>

							</tr>

							{% for passanger in visa.Passangers %}
								<tr>
                                    <td><a target="_blank" href="/Corporate/Employee/view-employee-frro-details/{{ passanger.id|default:'' }}">{{ passanger.core_employee_id|default:'NA' }}</a></td>
                                <td>{{ passanger.employee_name|default:'' }}</td>
								<td>{{ passanger.employee_email|default:''}}</td>
							    <td>{{ passanger.employee_contact|default:''}}</td>
								<td>{{ passanger.age|default:''}}</td>
							    <td>{{ passanger.gender|default:''}}</td>

								</tr>
							{% endfor %}


							 </table>
                        </div>

                    </div>
                    </div>

                 <div class="card">
                    <div class="card-head card-topline-aqua">
                        <header>Employee Document Details</header>
                    </div>
                    <div class="card-body no-padding height-9">

                        <div class="form-group row">
							<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">

                                {% for employee in visa.EmployeesDocs %}

								<tr>
                                    <td>{{employee.doc_name}}</td>
                                    <td>{% if employee.doc_file %}<a target="_blank" href="{{employee.doc_file}}" >Download</a>{% else %}<label style="color:red;">Document Not Upload</label>{% endif %}</td>
                                    <td>
                                        <a title="Add/Change Document" style="background:cadetblue; color:white;" data-target="#model_action_tracking" data-id="{{employee.id}}"
                                                       data-toggle="modal" class="btn btn-primary btn-xs"> Change </a></td>

                                </tr>


                                {% endfor %}


							 </table>
                        </div>

                    </div>
                    </div>



            </div>





  <div class="row">
               {% for corp_acces in corp_access %}

                <div class="col-md-12">
                    <div class="row">
                        {% if corp_acces.no_of_auth_level == 2 %}
                        <div class="col-md-6">

                            <div class="card">
                    <div class="card-head card-topline-aqua">
                        <header>Group & Approval Details</header>
                    </div>
                    <div class="card-body no-padding height-9">

                        <div class="form-group row">
							<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">
								  <tr>
                                    <td>Group Name</td>
                                    <td>{{visa.group_name}}</td>
                                  </tr>
                                 <tr>
                                    <td>Zone Name</td>
                                    <td>{{visa.zone_name}}</td>
                                  </tr>
                                <tr>
                                    <td>Approval CID</td>
                                    <td>{{visa.group_auth_cid}}</td>
                                  </tr>
                                <tr>
                                    <td>Approval Name</td>
                                    <td>{{visa.group_auth_name}}</td>
                                  </tr>
                                 <tr>
                                    <td>Approval Email</td>
                                    <td>{{visa.group_auth_email}}</td>
                                  </tr>
                                <tr>
                                    <td>Approval Contact</td>
                                    <td>{{visa.group_auth_contact}}</td>
                                  </tr>

							 </table>
                        </div>

                    </div>
                    </div>
                    </div>
                        {% endif %}


                    {% if corp_acces.no_of_auth_level == 1 or corp_acces.no_of_auth_level == 2 %}
                         <div class="col-md-6">
                             <div class="card">
                    <div class="card-head card-topline-aqua">
                        <header>Subroup & Approval Details</header>
                    </div>
                    <div class="card-body no-padding height-9">

                        <div class="form-group row">
							<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">
								  <tr>
                                    <td>Subgroup Name</td>
                                    <td>{{visa.subgroup_name}}</td>
                                  </tr>

                                <tr>
                                    <td>Approval CID</td>
                                    <td>{{visa.subgroup_auth_cid}}</td>
                                  </tr>
                                <tr>
                                    <td>Approval Name</td>
                                    <td>{{visa.subgroup_auth_name}}</td>
                                  </tr>
                                 <tr>
                                    <td>Approval Email</td>
                                    <td>{{visa.subgroup_auth_email}}</td>
                                  </tr>
                                <tr>
                                    <td>Approval Contact</td>
                                    <td>{{visa.subgroup_auth_contact}}</td>
                                  </tr>

							 </table>
                        </div>

                    </div>
                    </div>
                    </div>
                        {% endif %}
                        </div>
                    </div>

                     {% endfor %}

                 <div class="col-md-12">
                 <div class="card">
                    <div class="card-head card-topline-aqua">
                        <header>Comment Details</header>
                    </div>
                    <div class="card-body no-padding height-9">

                        <div class="form-group row">
							<table class="table table-striped table-bordered bootstrap-datatable datatable responsive">
								  <tr>
                                    <td>Comments</td>
                                      <td>
                                    {% with visa.ActionLogs|first as first_object %}
                                             <b> {{ first_object.employee_name }} </b> [ {{first_object.action_date |datetime_format}} ]: {{visa.reason_booking}}
                                        {% endwith %}

                                      </td>

                                </tr>

							 </table>
                        </div>

                    </div>
                    </div>
                    </div>


                </div>

    </div>

 {% endfor %}


</div>
<!-- end page content -->


{% else %}
<p>Welcome, new user. Please log in.<a href="/login">Login</a></p>
{% endif %}
<script type="text/javascript">
$(function() {

$('#model_action_tracking').on('show.bs.modal', function (event) {
var button = $(event.relatedTarget); // Button that triggered the modal
var id = button.data('id'); // Extract info from data-* attributes
var modal = $(this);
modal.find('#booking_id_tracking').val(id);

});

$('#modalAddHotelStatus_letter').on('show.bs.modal', function (event) {
var button = $(event.relatedTarget); // Button that triggered the modal
var status_booking_id = button.data('status_booking_id'); // Extract info from data-* attributes
var modal = $(this);
modal.find('#letter_booking_id').val(status_booking_id);
});

$('#modalAddHotelStatus_office').on('show.bs.modal', function (event) {
var button = $(event.relatedTarget); // Button that triggered the modal
var status_booking_id = button.data('office_booking_id'); // Extract info from data-* attributes
var modal = $(this);
modal.find('#office_booking_id').val(status_booking_id);
});

       });
</script>

{% if visa.tab_status == 'cancelled'%}
{% else %}
<script src="{% static 'assets/js/progress-bar.js' %}"></script>
{% endif %}
<script >
//we can set animation delay as following in ms (default 1000)
ProgressBar.singleStepAnimation = 1500;
val = $('#tab_status').val();
val = val.charAt(0).toUpperCase() + val.substr(1);

ProgressBar.init(
  [
        'Unapproved',
        'Approved',
        'Acknowledged',
        'Application Submitted',
        'Under-process',
        'Completed',

  ],
  val,
  'progress-bar-wrapper' // created this optional parameter for container name (otherwise default container created)
);
</script>
{% endblock %}



